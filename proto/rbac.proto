syntax = "proto3";
package clinic;

import "google/protobuf/timestamp.proto";
import "google/protobuf/struct.proto";

// ============================================================================
// Core Messages
// ============================================================================

message Role {
    string id = 1;
    string name = 2;
    string description = 3;
    google.protobuf.Struct permissions = 4;
    bool is_system_role = 5;
    bool is_active = 6;
    google.protobuf.Timestamp created_at = 7;
    google.protobuf.Timestamp updated_at = 8;
}

message User {
    string id = 1;
    string role_id = 2;
    string email = 3;
    string password_hash = 4;
    string first_name = 5;
    string last_name = 6;
    bool is_provider = 7;
    string provider_npi = 8;
    string phone = 9;
    bool is_active = 10;
    google.protobuf.Timestamp last_login = 11;
    int32 failed_login_attempts = 12;
    google.protobuf.Timestamp account_locked_until = 13;
    google.protobuf.Timestamp created_at = 14;
    google.protobuf.Timestamp updated_at = 15;
}

message Clinic {
    string id = 1;
    string name = 2;
    google.protobuf.Struct address = 3;
    string phone = 4;
    string email = 5;
    string timezone = 6;
    google.protobuf.Struct working_hours = 7;
    bool is_active = 8;
    google.protobuf.Timestamp created_at = 9;
    google.protobuf.Timestamp updated_at = 10;
}

message Location {
    string id = 1;
    string clinic_id = 2;
    string name = 3;
    string type = 4;
    google.protobuf.Struct address = 5;
    string phone = 6;
    string timezone = 7;
    bool is_active = 8;
    google.protobuf.Timestamp created_at = 9;
    google.protobuf.Timestamp updated_at = 10;
}

message Department {
    string id = 1;
    string location_id = 2;
    string name = 3;
    string manager_id = 4;
    bool is_active = 5;
    google.protobuf.Timestamp created_at = 6;
    google.protobuf.Timestamp updated_at = 7;
}

// ============================================================================
// Role Service Messages
// ============================================================================

message CreateRoleRequest {
    string name = 1;
    string description = 2;
    google.protobuf.Struct permissions = 3;
    bool is_system_role = 4;
    bool is_active = 5;
}

message UpdateRoleRequest {
    string id = 1;
    string name = 2;
    string description = 3;
    google.protobuf.Struct permissions = 4;
    bool is_active = 5;
}

message GetRoleRequest {
    string id = 1;
}

message DeleteRoleRequest {
    string id = 1;
}

message ListRolesRequest {
    PaginationRequest pagination = 1;
    bool is_active = 2;
}

message ListRolesResponse {
    repeated Role roles = 1;
    PaginationResponse pagination = 2;
}

// ============================================================================
// User Service Messages
// ============================================================================

message CreateUserRequest {
    string role_id = 1;
    string email = 2;
    string password = 3;
    string first_name = 4;
    string last_name = 5;
    bool is_provider = 6;
    string provider_npi = 7;
    string phone = 8;
}

message UpdateUserRequest {
    string id = 1;
    string role_id = 2;
    string email = 3;
    string first_name = 4;
    string last_name = 5;
    bool is_provider = 6;
    string provider_npi = 7;
    string phone = 8;
    bool is_active = 9;
}

message GetUserRequest {
    string id = 1;
}

message DeleteUserRequest {
    string id = 1;
}

message ListUsersRequest {
    PaginationRequest pagination = 1;
    bool is_active = 2;
    bool is_provider = 3;
    string role_id = 4;
}

message ListUsersResponse {
    repeated User users = 1;
    PaginationResponse pagination = 2;
}

message ChangePasswordRequest {
    string user_id = 1;
    string old_password = 2;
    string new_password = 3;
}

message VerifyPasswordRequest {
    string user_id = 1;
    string password = 2;
}

message VerifyPasswordResponse {
    bool is_valid = 1;
}

// ============================================================================
// Clinic Service Messages
// ============================================================================

message CreateClinicRequest {
    string name = 1;
    google.protobuf.Struct address = 2;
    string phone = 3;
    string email = 4;
    string timezone = 5;
    google.protobuf.Struct working_hours = 6;
}

message UpdateClinicRequest {
    string id = 1;
    string name = 2;
    google.protobuf.Struct address = 3;
    string phone = 4;
    string email = 5;
    string timezone = 6;
    google.protobuf.Struct working_hours = 7;
    bool is_active = 8;
}

message GetClinicRequest {
    string id = 1;
}

message DeleteClinicRequest {
    string id = 1;
}

message ListClinicsRequest {
    PaginationRequest pagination = 1;
    bool is_active = 2;
}

message ListClinicsResponse {
    repeated Clinic clinics = 1;
    PaginationResponse pagination = 2;
}

// ============================================================================
// Location Service Messages
// ============================================================================

message CreateLocationRequest {
    string clinic_id = 1;
    string name = 2;
    string type = 3;
    google.protobuf.Struct address = 4;
    string phone = 5;
    string timezone = 6;
}

message UpdateLocationRequest {
    string id = 1;
    string clinic_id = 2;
    string name = 3;
    string type = 4;
    google.protobuf.Struct address = 5;
    string phone = 6;
    string timezone = 7;
    bool is_active = 8;
}

message GetLocationRequest {
    string id = 1;
}

message DeleteLocationRequest {
    string id = 1;
}

message ListLocationsRequest {
    PaginationRequest pagination = 1;
    string clinic_id = 2;
    bool is_active = 3;
}

message ListLocationsResponse {
    repeated Location locations = 1;
    PaginationResponse pagination = 2;
}

// ============================================================================
// Department Service Messages
// ============================================================================

message CreateDepartmentRequest {
    string location_id = 1;
    string name = 2;
    string manager_id = 3;
}

message UpdateDepartmentRequest {
    string id = 1;
    string location_id = 2;
    string name = 3;
    string manager_id = 4;
    bool is_active = 5;
}

message GetDepartmentRequest {
    string id = 1;
}

message DeleteDepartmentRequest {
    string id = 1;
}

message ListDepartmentsRequest {
    PaginationRequest pagination = 1;
    string location_id = 2;
    bool is_active = 3;
}

message ListDepartmentsResponse {
    repeated Department departments = 1;
    PaginationResponse pagination = 2;
}

// ============================================================================
// Service Definitions
// ============================================================================

service RoleService {
    rpc CreateRole(CreateRoleRequest) returns (Role);
    rpc GetRole(GetRoleRequest) returns (Role);
    rpc UpdateRole(UpdateRoleRequest) returns (Role);
    rpc DeleteRole(DeleteRoleRequest) returns (google.protobuf.Empty);
    rpc ListRoles(ListRolesRequest) returns (ListRolesResponse);
}

service UserService {
    rpc CreateUser(CreateUserRequest) returns (User);
    rpc GetUser(GetUserRequest) returns (User);
    rpc UpdateUser(UpdateUserRequest) returns (User);
    rpc DeleteUser(DeleteUserRequest) returns (google.protobuf.Empty);
    rpc ListUsers(ListUsersRequest) returns (ListUsersResponse);
    rpc ChangePassword(ChangePasswordRequest) returns (google.protobuf.Empty);
    rpc VerifyPassword(VerifyPasswordRequest) returns (VerifyPasswordResponse);
}

service ClinicService {
    rpc CreateClinic(CreateClinicRequest) returns (Clinic);
    rpc GetClinic(GetClinicRequest) returns (Clinic);
    rpc UpdateClinic(UpdateClinicRequest) returns (Clinic);
    rpc DeleteClinic(DeleteClinicRequest) returns (google.protobuf.Empty);
    rpc ListClinics(ListClinicsRequest) returns (ListClinicsResponse);
}

service LocationService {
    rpc CreateLocation(CreateLocationRequest) returns (Location);
    rpc GetLocation(GetLocationRequest) returns (Location);
    rpc UpdateLocation(UpdateLocationRequest) returns (Location);
    rpc DeleteLocation(DeleteLocationRequest) returns (google.protobuf.Empty);
    rpc ListLocations(ListLocationsRequest) returns (ListLocationsResponse);
}

service DepartmentService {
    rpc CreateDepartment(CreateDepartmentRequest) returns (Department);
    rpc GetDepartment(GetDepartmentRequest) returns (Department);
    rpc UpdateDepartment(UpdateDepartmentRequest) returns (Department);
    rpc DeleteDepartment(DeleteDepartmentRequest) returns (google.protobuf.Empty);
    rpc ListDepartments(ListDepartmentsRequest) returns (ListDepartmentsResponse);
}
