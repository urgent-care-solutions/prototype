syntax = "proto3";

package audit;

service AuditService {
    rpc LogAction (AuditLogRequest) returns (AuditLogResponse);

    rpc QueryLogs (QueryLogsRequest) returns (QueryLogsResponse);
}

message AuditLogRequest {
    string user_id = 1;
    string user_email = 2;
    string user_role = 3;

    string action = 4;
    string resource_type = 5;
    string resource_id = 6;

    string service_name = 7;\
    string ip_addr = 8;
    string user_agent = 9;
    string request_id = 10;

    map<string, string> metadata = 11;
    bool success = 12;
    string error_msg = 13;
}

message AuditLogResponse {
  string log_id = 1;
  bool success = 2;
  string error = 3;
}

message QueryLogsRequest {
  string user_id = 1;
  string resource_id = 2;
  string action = 3;
  int32 limit = 4;
  int32 offset = 5;
}

message QueryLogsResponse {
  repeated AuditLogEntry logs = 1;
  int32 total_count = 2;
}

message AuditLogEntry {
  string id = 1;
  string timestamp = 2;
  string user_email = 3;
  string action = 4;
  string resource_type = 5;
  string resource_id = 6;
}
